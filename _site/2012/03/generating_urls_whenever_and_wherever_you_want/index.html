<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>BroadcastingAdam - Generating URLs Whenever & Wherever You Want</title>

    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.2r1/build/reset/reset-min.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />


    <script type="text/javascript" src="http://yandex.st/highlightjs/5.16/highlight.min.js"></script>
    <link rel="stylesheet" href="http://yandex.st/highlightjs/5.16/styles/github.min.css">
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="container">
      <header>
  <h1>BroadcastingAdam</h1>
  <a href="http://feeds.feedburner.com/BroadcastingAdam" id="rss"><img src="images/rss_icon.png" alt="rss" /></a>
  <nav>
    <a href="/">Home</a>
    <a href="/nettuts.html">Nettuts</a>
    <a href="/talks.html">Talks</a>
    <a href="/open_source.html">Open Source</a>
  </nav>
</header>


      <div id="content" class="post">
        <header >
          <h2>Generating URLs Whenever & Wherever You Want</h2>
          <div class='meta'>
            </p>March 05, 2012 &nbsp; | &nbsp; rails</p>
          </div>
        </header>
        <article>
          <p>One of my big gripes with Rails is that it makes it very hard to do things outside the request/response cycle. It is a web framework, but now we have an increasing amount of things happening outside of that workflow. You may have noticed that it&#8217;s annoying to generate URLs when you&#8217;re not in a view or a controller. There is one simple reason for this. They don&#8217;t want to you to do that. There is also a reason why you cannot do that. The structure of the route helpers require the request because they know everything about where it came from, aka they know the host. You need to know the host to generate urls and do all that other stuff. If there is no request, there is no host.</p>

<p>ActionMailer is one very common case for generating URL&#8217;s outside of request/response. Links inside emails need the full URL because they don&#8217;t live on webpage. This is why you have to set the default url options to use route helpers inside mailers. So since ActionMailer can generate URLs outside the request, we can do that do. Most applications are going to have ActionMailer configured anyways, so we can just piggy back off the configuration.</p>

<p>Here&#8217;s an example <code>Router</code> class</p>

<pre><code>class Router
  include Rails.application.routes.url_helpers

  def self.default_url_options
    ActionMailer::Base.default_url_options
  end
end

router = Router.new
router.posts_url  # http://localhost:3000/posts
router.posts_path # /posts

# all -2ez-</code></pre>

<p>If you want to simply include routing support in any class you can easily combine this into a module</p>

<pre><code>module Routing
  extend ActiveSupport::Concern
  include Rails.application.routes.url_helpers

  included do
    def default_url_options
      ActionMailer::Base.default_url_options
    end
  end
end

class UrlGenerator
  include Routing
end

generator = UrlGenerator.new
generator.posts_url
generator.posts_path</code></pre>

<p>Happy routing!</p>

          <h3>Contact Me</h3>
          <p>
            Find a problem or have a question about this post? <a href="http://twitter.com/adman65/">@adman65</a> on
            Twitter or Adman65 on #freenode. Find me in (#rubyonrails or
            #sproutcore). You can find my code on <a href="http://github.com/twinturbo/">GitHub</a> or hit me up on
            <a href="https://plus.google.com/u/0/116377228668850173159">Google+</a>.
          </p>
        </article>
      </div>
    </div>

    <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4eb0f672613f5d482f000001');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

  </body>
</html>
